<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Note-Taking Web Application">
    <title>Note Taking App</title>
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}?v=1" type="image/png">
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='icons.css') }}">
</head>

<body data-timezone="{{ user.timezone or 'UTC' }}">
    <!-- Mobile Header -->
    <header class="mobile-header">
        <button class="mobile-menu-btn" id="mobile-menu-toggle" aria-label="Toggle menu">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 12h18M3 6h18M3 18h18" />
            </svg>
        </button>
        <div class="logo">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Notes" class="logo-img">
            <span class="logo-text">Notes</span>
        </div>
        <button id="theme-toggle-mobile" class="icon-button" data-tooltip="Toggle theme">
            <svg class="icon icon-sun" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="4" />
                <path
                    d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
            </svg>
        </button>
    </header>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="logo-img">
                    </div>
                    <span class="logo-text">Notes</span>
                </div>
                <button id="theme-toggle" class="icon-button" data-tooltip="Toggle theme (Ctrl+T)">
                    <svg class="icon icon-sun" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="4" />
                        <path
                            d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
                    </svg>
                </button>
            </div>

            <!-- User Info -->
            <div class="user-info">
                {% if user.avatar_url %}
                <img src="{{ user.avatar_url }}" alt="Avatar" class="user-avatar">
                {% else %}
                <div class="user-avatar-placeholder">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                </div>
                {% endif %}
                <div class="user-details">
                    <span class="user-name">{{ user.display_name }}</span>
                    {% if user.is_guest %}
                    <span class="guest-badge">Guest</span>
                    {% endif %}
                    {% if user.bio %}
                    <p class="user-bio" title="{{ user.bio }}">{{ user.bio }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Search -->
            <div class="search-box">
                <svg class="icon search-icon" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.3-4.3" />
                </svg>
                <form action="{{ url_for('index') }}" method="GET">
                    <input type="text" name="q" id="search-input" placeholder="Search notes... (Ctrl+K)"
                        value="{{ search_query }}" autocomplete="off">
                    {% if category_filter %}
                    <input type="hidden" name="category" value="{{ category_filter }}">
                    {% endif %}
                </form>
            </div>

            <!-- Categories Filter -->
            <nav class="categories-nav">
                <h3>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                    </svg>
                    Categories
                </h3>
                <a href="{{ url_for('index') }}" class="category-link {% if not category_filter %}active{% endif %}">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                        <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                    </svg>
                    All Notes
                    <span class="count">{{ stats.active or 0 }}</span>
                </a>
                {% for cat in categories %}
                <a href="{{ url_for('index', category=cat.id) }}"
                    class="category-link {% if category_filter|string == cat.id|string %}active{% endif %}">
                    <span class="color-dot" style="background: {{ cat.color }}"></span>
                    {{ cat.name }}
                </a>
                {% endfor %}
                <a href="{{ url_for('manage_categories') }}" class="category-link add-category">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M5 12h14" />
                        <path d="M12 5v14" />
                    </svg>
                    Manage Categories
                </a>
            </nav>

            <!-- Quick Links -->
            <nav class="quick-links">
                <a href="{{ url_for('profile') }}">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                    Profile
                </a>
                <a href="{{ url_for('index', archived='1') }}" class="{% if show_archived %}active{% endif %}">
                    <svg class="icon" viewBox="0 0 24 24">
                        <rect width="20" height="5" x="2" y="3" rx="1" />
                        <path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8" />
                        <path d="M10 12h4" />
                    </svg>
                    Archived
                    <span class="count">{{ stats.archived or 0 }}</span>
                </a>
            </nav>

            <!-- Import / Export Section -->
            <div class="export-section">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" x2="12" y1="15" y2="3" />
                    </svg>
                    Import / Export
                </h4>
                <div class="export-buttons">
                    <a href="{{ url_for('export_notes', format='json') }}" class="export-btn export-btn-json">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                            <polyline points="14 2 14 8 20 8" />
                            <path d="M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1" />
                            <path d="M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1" />
                        </svg>
                        JSON
                    </a>
                    <a href="{{ url_for('export_notes', format='txt') }}" class="export-btn export-btn-txt">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="16" x2="8" y1="13" y2="13" />
                            <line x1="16" x2="8" y1="17" y2="17" />
                            <line x1="10" x2="8" y1="9" y2="9" />
                        </svg>
                        TXT
                    </a>
                </div>
                <!-- Import -->
                <form action="{{ url_for('import_notes') }}" method="POST" enctype="multipart/form-data"
                    class="import-form" id="import-form">
                    <label class="import-btn" for="import-file">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" x2="12" y1="3" y2="15" />
                        </svg>
                        Import Notes
                    </label>
                    <input type="file" id="import-file" name="file" accept=".json,.txt" class="hidden-input">
                </form>
            </div>

            <!-- Logout -->
            <div class="sidebar-footer">
                {% if user.is_guest %}
                <a href="{{ url_for('auth.cognito_login') }}" class="btn btn-primary btn-small">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                        <polyline points="17 21 17 13 7 13 7 21" />
                        <polyline points="7 3 7 8 15 8" />
                    </svg>
                    Create Account
                </a>
                {% endif %}
                <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary btn-small">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" x2="9" y1="12" y2="12" />
                    </svg>
                    Logout
                </a>
            </div>
        </aside>

        <!-- Sidebar Overlay (Mobile) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Guest Banner -->
            {% if user.is_guest %}
            <div class="guest-banner">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                    <path d="M12 9v4" />
                    <path d="M12 17h.01" />
                </svg>
                <span>You're using guest mode.</span>
                <a href="{{ url_for('auth.cognito_login') }}" class="btn btn-small btn-primary">Create Account</a>
            </div>
            {% endif %}

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                <div class="flash {{ category }}">
                    {% if category == 'success' %}
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                        <polyline points="22 4 12 14.01 9 11.01" />
                    </svg>
                    {% elif category == 'error' %}
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" />
                        <path d="m15 9-6 6" />
                        <path d="m9 9 6 6" />
                    </svg>
                    {% else %}
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 16v-4" />
                        <path d="M12 8h.01" />
                    </svg>
                    {% endif %}
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Greeting Header with Clock -->
            <div class="greeting-header">
                <div class="greeting-text">
                    <h2 id="greeting-message">Hello, {{ user.display_name }}!</h2>
                    <p class="greeting-date" id="greeting-clock">Loading...</p>
                </div>
                <div class="stats-bar">
                    <div class="stat-item">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                            <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                        </svg>
                        <span>{{ stats.active or 0 }} notes</span>
                    </div>
                    <div class="stat-item">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                        </svg>
                        <span>{{ stats.pinned or 0 }} pinned</span>
                    </div>
                    <div class="stat-item">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect width="20" height="5" x="2" y="3" rx="1" />
                            <path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8" />
                            <path d="M10 12h4" />
                        </svg>
                        <span>{{ stats.archived or 0 }} archived</span>
                    </div>
                </div>
            </div>

            <!-- New Note Form -->
            <section class="note-form-section">
                <form action="{{ url_for('add_note') }}" method="POST" class="note-form">
                    <div class="form-header">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 20h9" />
                            <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z" />
                        </svg>
                        <span>Create a new note</span>
                    </div>
                    <input type="text" name="title" placeholder="Note title (optional)" class="note-title-input">
                    <textarea name="content" id="note-content" placeholder="Write your note here... (Supports Markdown)"
                        rows="4" required></textarea>
                    <div class="word-count" id="word-count">0 words Â· 0 characters</div>
                    <div class="form-actions">
                        <div class="form-left">
                            <select name="category_id" class="category-select">
                                <option value="">No category</option>
                                {% for cat in categories %}
                                <option value="{{ cat.id }}" style="color: {{ cat.color }}">{{ cat.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                <polyline points="17 21 17 13 7 13 7 21" />
                                <polyline points="7 3 7 8 15 8" />
                            </svg>
                            Save Note
                            <span class="shortcut">(Ctrl+Enter)</span>
                        </button>
                    </div>
                </form>
            </section>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-item">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                        <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                    </svg>
                    <span class="stat-value">{{ stats.active or 0 }}</span>
                    <span class="stat-label">notes</span>
                </div>
                <div class="stat-item">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 17v5" />
                        <path
                            d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3.76Z" />
                    </svg>
                    <span class="stat-value">{{ stats.pinned or 0 }}</span>
                    <span class="stat-label">pinned</span>
                </div>
                <div class="stat-item">
                    <svg class="icon" viewBox="0 0 24 24">
                        <rect width="20" height="5" x="2" y="3" rx="1" />
                        <path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8" />
                        <path d="M10 12h4" />
                    </svg>
                    <span class="stat-value">{{ stats.archived or 0 }}</span>
                    <span class="stat-label">archived</span>
                </div>
            </div>

            <!-- Notes List -->
            <section class="notes-section">
                {% if notes %}
                <div class="notes-grid">
                    {% for note in notes %}
                    <article class="note-card {% if note.is_pinned %}pinned{% endif %}">
                        <div class="note-header">
                            {% if note.is_pinned %}
                            <span class="pin-indicator" data-tooltip="Pinned">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 17v5" />
                                    <path
                                        d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3.76Z" />
                                </svg>
                            </span>
                            {% endif %}
                            {% if note.category_name %}
                            <span class="note-category" style="background: {{ note.category_color }}">
                                {{ note.category_name }}
                            </span>
                            {% endif %}
                            <span class="note-date">{{ note.updated_at.strftime('%b %d, %Y') }}</span>
                        </div>

                        {% if note.title %}
                        <h3 class="note-title">{{ note.title }}</h3>
                        {% endif %}

                        <div class="note-content markdown-body">
                            {{ note.content_html|safe }}
                        </div>

                        <div class="note-actions-bar">
                            <button class="icon-button edit edit-btn" data-note-id="{{ note.id }}" data-tooltip="Edit">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                                    <path d="m15 5 4 4" />
                                </svg>
                            </button>

                            <form action="{{ url_for('toggle_pin', note_id=note.id) }}" method="POST"
                                class="inline-form">
                                <button type="submit" class="icon-button pin"
                                    data-tooltip="{% if note.is_pinned %}Unpin{% else %}Pin{% endif %}">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M12 17v5" />
                                        <path
                                            d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3.76Z" />
                                    </svg>
                                </button>
                            </form>

                            <button type="button" class="icon-button share share-btn" data-note-id="{{ note.id }}"
                                data-tooltip="Share">
                                {% if note.is_public %}
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                                </svg>
                                {% else %}
                                <svg class="icon" viewBox="0 0 24 24">
                                    <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                </svg>
                                {% endif %}
                            </button>

                            <form action="{{ url_for('toggle_archive', note_id=note.id) }}" method="POST"
                                class="inline-form">
                                <button type="submit" class="icon-button archive"
                                    data-tooltip="{% if note.is_archived %}Restore{% else %}Archive{% endif %}">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <rect width="20" height="5" x="2" y="3" rx="1" />
                                        <path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8" />
                                        <path d="M10 12h4" />
                                    </svg>
                                </button>
                            </form>

                            <form action="{{ url_for('delete_note', note_id=note.id) }}" method="POST"
                                class="inline-form delete-form">
                                <button type="submit" class="icon-button delete" data-tooltip="Delete">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M3 6h18" />
                                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                        <line x1="10" x2="10" y1="11" y2="17" />
                                        <line x1="14" x2="14" y1="11" y2="17" />
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </article>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-illustration">
                        <svg viewBox="0 0 200 200" class="empty-svg">
                            <defs>
                                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#818cf8;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#c084fc;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <rect x="40" y="50" width="120" height="100" rx="8" fill="url(#grad1)" opacity="0.1" />
                            <rect x="50" y="60" width="100" height="80" rx="6" fill="var(--bg-secondary)"
                                stroke="url(#grad1)" stroke-width="2" />
                            <line x1="65" y1="80" x2="135" y2="80" stroke="url(#grad1)" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="65" y1="95" x2="120" y2="95" stroke="var(--text-muted)" stroke-width="2"
                                stroke-linecap="round" opacity="0.5" />
                            <line x1="65" y1="110" x2="110" y2="110" stroke="var(--text-muted)" stroke-width="2"
                                stroke-linecap="round" opacity="0.3" />
                            <circle cx="160" cy="40" r="20" fill="url(#grad1)" opacity="0.2" />
                            <path d="M155 40 L160 45 L170 35" stroke="url(#grad1)" stroke-width="3" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    {% if search_query %}
                    <h3>No notes found</h3>
                    <p>We couldn't find any notes matching "{{ search_query }}"</p>
                    <a href="{{ url_for('index') }}" class="btn btn-secondary">Clear Search</a>
                    {% elif show_archived %}
                    <h3>No archived notes</h3>
                    <p>Notes you archive will appear here</p>
                    <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Notes</a>
                    {% else %}
                    <h3>Start Your Journey</h3>
                    <p>Create your first note to get started!</p>
                    <button class="btn btn-primary" onclick="document.getElementById('note-content').focus()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M5 12h14" />
                            <path d="M12 5v14" />
                        </svg>
                        Create Note
                    </button>
                    {% endif %}
                </div>
                {% endif %}
            </section>
        </main>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                        <path d="m15 5 4 4" />
                    </svg>
                    Edit Note
                </h2>
                <button class="modal-close" id="modal-close">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M18 6 6 18" />
                        <path d="m6 6 12 12" />
                    </svg>
                </button>
            </div>

            <div class="modal-tabs">
                <button type="button" class="tab-btn active" id="tab-raw">Raw</button>
                <button type="button" class="tab-btn" id="tab-preview">Preview</button>
            </div>

            <form id="edit-form" method="POST">
                <input type="text" name="title" id="edit-title" placeholder="Note title">

                <div class="editor-toolbar">
                    <button type="button" class="toolbar-btn" id="btn-attach" title="Attach file">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                        </svg>
                        Attach
                    </button>
                    <!-- Visual separator/spacer -->
                    <span style="flex: 1;"></span>
                    <span class="text-sm text-muted" id="edit-status"></span>
                </div>
                <!-- Hidden file input -->
                <input type="file" id="attach-input" hidden>

                <div class="edit-mode-container">
                    <textarea name="content" id="edit-content" rows="8" required></textarea>
                    <div id="edit-preview" class="hidden"></div>
                </div>

                <div id="attachment-list" class="attachment-list">
                    <!-- Attachments will be injected here -->
                </div>

                <select name="category_id" id="edit-category" class="category-select">
                    <option value="">No category</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="modal-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Modal (Read Only) -->
    <div id="view-modal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="view-title"></h2>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button class="icon-button" id="view-edit-btn" title="Edit Note">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                            <path d="m15 5 4 4" />
                        </svg>
                    </button>
                    <button class="modal-close" id="view-modal-close">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M18 6 6 18" />
                            <path d="m6 6 12 12" />
                        </svg>
                    </button>
                </div>
            </div>

            <div id="view-content" class="markdown-body" style="flex: 1; overflow-y: auto; padding: 1.5rem 0;"></div>

            <div id="view-attachments" class="attachment-list view-mode">
                <!-- Read-only attachments -->
            </div>

            <div
                style="padding-top: 1rem; margin-top: auto; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; color: var(--text-muted); font-size: 0.9rem;">
                <span id="view-date"></span>
                <span id="view-category" class="note-category"></span>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help -->
    <div id="shortcuts-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M10 8h.01" />
                        <path d="M12 12h.01" />
                        <path d="M14 8h.01" />
                        <path d="M16 12h.01" />
                        <path d="M18 8h.01" />
                        <path d="M6 8h.01" />
                        <path d="M7 16h10" />
                        <path d="M8 12h.01" />
                        <rect width="20" height="16" x="2" y="4" rx="2" />
                    </svg>
                    Keyboard Shortcuts
                </h2>
                <button class="modal-close shortcuts-close">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M18 6 6 18" />
                        <path d="m6 6 12 12" />
                    </svg>
                </button>
            </div>
            <ul class="shortcuts-list">
                <li><kbd>Ctrl</kbd> + <kbd>K</kbd> <span>Focus search</span></li>
                <li><kbd>Ctrl</kbd> + <kbd>Enter</kbd> <span>Save note</span></li>
                <li><kbd>Ctrl</kbd> + <kbd>T</kbd> <span>Toggle theme</span></li>
                <li><kbd>Esc</kbd> <span>Close modal</span></li>
                <li><kbd>?</kbd> <span>Show shortcuts</span></li>
            </ul>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                        <polyline points="16 6 12 2 8 6" />
                        <line x1="12" y1="2" x2="12" y2="15" />
                    </svg>
                    Share Note
                </h2>
                <button class="modal-close" id="share-modal-close">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M18 6 6 18" />
                        <path d="m6 6 12 12" />
                    </svg>
                </button>
            </div>

            <div class="share-modal-body" style="padding: 1rem 0;">
                <div id="share-private-state">
                    <p class="text-muted" style="margin-bottom: 1.5rem; text-align: center;">This note is currently
                        private. Generate a public link to share it with others.</p>
                    <button id="btn-generate-link" class="btn btn-primary"
                        style="width: 100%; justify-content: center;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                        </svg>
                        Generate Public Link
                    </button>
                </div>

                <div id="share-public-state" class="hidden">
                    <p class="text-muted" style="margin-bottom: 1rem;">Anyone with this link can view this note.</p>

                    <div class="input-group" style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <input type="text" id="share-link-input" readonly
                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                        <button id="btn-copy-link" class="btn btn-secondary" title="Copy Link">
                            <svg class="icon" viewBox="0 0 24 24">
                                <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                            </svg>
                        </button>
                    </div>

                    <button id="btn-stop-sharing" class="btn btn-danger-outline"
                        style="width: 100%; justify-content: center;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                        </svg>
                        Stop Sharing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>